<!-- build time:Wed Jan 23 2019 11:42:47 GMT+0800 (CST) --><!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.png?v=5.1.4"><link rel="mask-icon" href="/images/avatar.png?v=5.1.4" color="#222"><meta name="keywords" content="python,"><meta name="description" content="如果问大家离开北邮最不舍的东西是什么？很多人肯定会脱口而出：北邮人BT！显然，北邮人BT已经融为每个BYR生活的一部分了。那么就从这个网站下手，练一练Python的爬虫吧。 很早之前写这篇文章时，对下载北邮人BT的资源的理解是先通过模拟北邮人BT登录，然后用代码下载资源。现在觉得这么做太复杂了，所以这篇文章就改成用python模拟登录北邮人BT的教程吧。"><meta name="keywords" content="python"><meta property="og:type" content="article"><meta property="og:title" content="Python实现北邮人BT模拟登录"><meta property="og:url" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/index.html"><meta property="og:site_name" content="负雪明烛的博客"><meta property="og:description" content="如果问大家离开北邮最不舍的东西是什么？很多人肯定会脱口而出：北邮人BT！显然，北邮人BT已经融为每个BYR生活的一部分了。那么就从这个网站下手，练一练Python的爬虫吧。 很早之前写这篇文章时，对下载北邮人BT的资源的理解是先通过模拟北邮人BT登录，然后用代码下载资源。现在觉得这么做太复杂了，所以这篇文章就改成用python模拟登录北邮人BT的教程吧。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/2017/08/25/byrbt-login/head.jpg"><meta property="og:image" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/2017/08/25/byrbt-login/web.png"><meta property="og:image" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/2017/08/25/byrbt-login/pre.png"><meta property="og:image" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/2017/08/25/byrbt-login/login.png"><meta property="og:image" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/2017/08/25/byrbt-login/hash.png"><meta property="og:image" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/2017/08/25/byrbt-login/imgtochar.png"><meta property="og:image" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/2017/08/25/byrbt-login/dologin.png"><meta property="og:image" content="http://fuxuemingzhu.me/drawing/index/caicai-drawing-dark2.jpg"><meta property="og:updated_time" content="2018-06-10T13:34:14.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Python实现北邮人BT模拟登录"><meta name="twitter:description" content="如果问大家离开北邮最不舍的东西是什么？很多人肯定会脱口而出：北邮人BT！显然，北邮人BT已经融为每个BYR生活的一部分了。那么就从这个网站下手，练一练Python的爬虫吧。 很早之前写这篇文章时，对下载北邮人BT的资源的理解是先通过模拟北邮人BT登录，然后用代码下载资源。现在觉得这么做太复杂了，所以这篇文章就改成用python模拟登录北邮人BT的教程吧。"><meta name="twitter:image" content="http://fuxuemingzhu.me/2017/08/25/byrbt-login/2017/08/25/byrbt-login/head.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://fuxuemingzhu.me/2017/08/25/byrbt-login/"><title>Python实现北邮人BT模拟登录 | 负雪明烛的博客</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?720cd3f4909308ad8a7cac68733c0a19";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">负雪明烛的博客</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">好好学习，努力成为渣硕</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签云</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="menu-item-icon fa fa-fw fa-commenting"></i><br>留言板</a></li><li class="menu-item menu-item-drawing"><a href="/drawing/" rel="section"><i class="menu-item-icon fa fa-fw fa-picture-o"></i><br>菜菜手绘坊</a></li></ul></nav></div></header><script src="https://cdn.bootcss.com/echarts/4.1.0.rc2/echarts.min.js"></script><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://fuxuemingzhu.me/2017/08/25/byrbt-login/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="负雪明烛"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="负雪明烛的博客"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Python实现北邮人BT模拟登录</h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-25T14:53:14+08:00">2017-08-25 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">术业专攻</span> </a></span></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/08/25/byrbt-login/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/08/25/byrbt-login/" itemprop="commentCount"></span> </a></span><span class="post-meta-divider">|</span> <span class="page-pv">热度 <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>℃</span></div></header><div class="post-body" itemprop="articleBody"><p>如果问大家离开北邮最不舍的东西是什么？很多人肯定会脱口而出：北邮人BT！显然，北邮人BT已经融为每个BYR生活的一部分了。那么就从这个网站下手，练一练Python的爬虫吧。</p><p>很早之前写这篇文章时，对下载北邮人BT的资源的理解是先通过模拟北邮人BT登录，然后用代码下载资源。现在觉得这么做太复杂了，所以这篇文章就改成用python模拟登录北邮人BT的教程吧。</p><img src="/2017/08/25/byrbt-login/2017/08/25/byrbt-login/head.jpg" alt="head.jpg"> <a id="more"></a><h2 id="教程所需环境"><a href="#教程所需环境" class="headerlink" title="教程所需环境"></a>教程所需环境</h2><p>下面是本文核心的运行环境，没有在其他环境下运行和测试，推荐大家和我采用相同的环境。</p><ol><li>Python 3.x</li><li>支持ipv6的服务器，本文使用<a href="https://m.do.co/c/86d4e56f6c7a" target="_blank" rel="external">Digital Ocean</a></li></ol><p>大家可能和我一样在购买Digital Ocean之后想着如何让它发挥出更大的作用，我发现Digital Ocean支持ipv6，因此，我就想到能不能让它作为ipv4和ipv6的中转站，实现很多有意思的事情，于是就萌发了在校外下载北邮人BT资源的想法。</p><p>采用本教程的方法能够实现在校外的无ipv6的环境访问和下载北邮人BT资源到你的电脑，刷BT分享率，简直不要再赞。</p><p>更多关于选择Digital Ocean的理由可以见文末。</p><h2 id="前期配置"><a href="#前期配置" class="headerlink" title="前期配置"></a>前期配置</h2><p>在购买DO服务器之后，会获得v4和v6两个地址，这两个地址都能访问DO。如果你没有ipv6的地址，但是你可以通过ipv4连接到DO服务器，然后让服务器通过ipv6访问和下载BT资源，资源先下载到服务器上，最后通过ipv4传到你的电脑上。这就是本文的思路。</p><p>在购买服务器完成之后，建议大家<a href="http://jerryzou.com/posts/shadowsocks-and-digitalocean/" target="_blank" rel="external">配置shadowsocks</a>，这真是个好东西，不仅可以实现科学上网，还可以让你在v4的环境下访问v6的网页，效果可以看下图：</p><img src="/2017/08/25/byrbt-login/2017/08/25/byrbt-login/web.png" alt="在ipv4环境下访问北邮人BT网页" title="在ipv4环境下访问北邮人BT网页"><p>上图是在我把shadowsocks设置为全局模式时，能够使用浏览器访问北邮人BT，但系统没有ipv6地址，所以命令行可以连接到北邮人论坛却无法连接到北邮人BT。</p><p>这样做可以让你挑选北邮人BT的资源，但是因为没有ipv6的环境，所以不能方便地通过uTorrent等客户端下载资源。我们的做法是在自己电脑上使用shadowsocks代理访问北邮人BT挑选资源，得到想要下载的资源的id，然后在服务器上运行python脚本下载该id对应的资源，再通过ssh或者ftp传到本地电脑。</p><h2 id="登录分析"><a href="#登录分析" class="headerlink" title="登录分析"></a>登录分析</h2><p>前文已经分析了，必须实现在DO服务器上能模拟登录北邮人BT，才能下载资源。故我们首先实现模拟登录BT。</p><p>网站模拟登录的分析过程可以参考之前的<a href="http://fuxuemingzhu.me/2017/08/12/byrbbs-login/">模拟登录北邮人论坛</a>的文章，这里简单分析BT的模拟登录过程。</p><p>在浏览器上打开北邮人BT，退出登录，即在<a href="http://bt.byr.cn/login.php" target="_blank" rel="external">http://bt.byr.cn/login.php</a> 界面，按F12打开开发者选项，选择Network选项卡，勾上Preserve log选项。</p><img src="/2017/08/25/byrbt-login/2017/08/25/byrbt-login/pre.png" alt="登录前的状态" title="登录前的状态"><p>然后填写用户名密码、验证码，点击登录，如果填写的正确就能跳转到BT主界面。</p><img src="/2017/08/25/byrbt-login/2017/08/25/byrbt-login/login.png" alt="选项卡记录的登录参数" title="选项卡记录的登录参数"><p>从上面的截图能看出来，在登录BT的时候向<em><a href="http://bt.byr.cn/takelogin.php" target="_blank" rel="external">http://bt.byr.cn/takelogin.php</a></em>通过POST方式发送了4个参数，包括用户名，密码，验证码，还有验证码图片的hash。前面的三个参数都是自己填写的，但是验证码的hash从哪里找出来呢？难道自己计算吗？</p><p>还好，通过在源代码中搜索<strong>imagehash</strong>，可以发现出现了两次，一次是图片的链接，一次是一个隐藏的输入框，输入框里包含着正确的iamgehash。如下图：</p><img src="/2017/08/25/byrbt-login/2017/08/25/byrbt-login/hash.png" alt="找出imagehash" title="找出imagehash"><p>综上分析，我们已经可以把登录要提交的所有信息全部分析出来了，可以在源代码中使用正则表达式等工具提取出imagehash，但验证码要怎么处理呢？</p><h2 id="验证码处理"><a href="#验证码处理" class="headerlink" title="验证码处理"></a>验证码处理</h2><p>前面虽然找出了验证码图片的hash，但是没法找出验证码图片对应的字符串（能找出的话验证码也没存在的意义了）。我们可以推测，当我们提交验证码字符串的时候，服务器会进行输入的验证码字符串和验证码图片hash的验证，如果匹配说明验证码正确。下面我们要解决验证码的问题。</p><p>处理验证码一般有几个思路：</p><ol><li>手动填写</li><li>机器学习模型处理</li><li>第三方服务</li></ol><p>这里为了方便，直接使用手动填写方式即可。思路是这样的，先用Python请求到登录页的网址，然后把验证码图片保存下来，再然后直接打开图片查看，把验证码填写即可。</p><p>如果你在自己电脑上模拟登录可以很简单的用图片查看器打开图片，但是如果在服务器上运行脚本的话该怎么办呢？我这里提供几个思路。</p><ol><li>catimg在命令行中显示图片（不清晰）</li><li>把图片下载到本地查看（麻烦）</li><li>把图片转成字符画在命令行显示（代码量大）</li></ol><p>我用的比较高逼格的第三种方式，效果如下：</p><img src="/2017/08/25/byrbt-login/2017/08/25/byrbt-login/imgtochar.png" alt="验证码转字符画" title="验证码转字符画"><p>能在终端中查看到验证码图片的话就能手动输入了~至此模拟登录要找到各个参数已经完全找到了。</p><h2 id="保存cookies"><a href="#保存cookies" class="headerlink" title="保存cookies"></a>保存cookies</h2><p>我们没有必要每次访问bt都去模拟登录，这样很麻烦。为了方便我们可以把cookies保存，以后使用cookies自动登录即可。</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p>下面是完整的代码，将代码保存成.py文件再传到DO服务器，用Python命令运行。</p><p>运行之后，当前目录下会生成check_code.jpg,imgtochar.txt,cookies.txt等文件。请不要删除cookies.txt文件，这是以后登录使用的cookies。程序运行时会自动监测当前文件夹下是否存在cookies.txt，如果不存在会执行手动输入用户名密码验证码的登录操作，否则会直接使用cookies登录。</p><p>密码输入采用不显示的方式，不用担心密码没输上去。这是在服务器上运行程序的结果，注意，第一次需要输入用户名密码验证码，第二次登录直接使用cookies登录、不用再次输入。</p><img src="/2017/08/25/byrbt-login/2017/08/25/byrbt-login/dologin.png" alt="服务器上两次模拟登录" title="服务器上两次模拟登录"><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding=utf-8</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> re</div><div class="line"><span class="keyword">import</span> pickle</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> requests.utils</div><div class="line"></div><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"></div><div class="line">imgpath = <span class="string">'check_code.jpg'</span></div><div class="line"></div><div class="line">ascii_char = list(<span class="string">r"$@&amp;%B#... "</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">select_ascii_char</span><span class="params">(r, g, b)</span>:</span></div><div class="line">	gray = int((<span class="number">19595</span> * r + <span class="number">38469</span> * g + <span class="number">7472</span> * b) &gt;&gt; <span class="number">16</span>)  <span class="comment"># ‘RGB－灰度值’转换公式</span></div><div class="line">	unit = <span class="number">256.0</span> / len(ascii_char)  <span class="comment"># ascii_char中的一个字符所能表示的灰度值区间</span></div><div class="line">	<span class="keyword">return</span> ascii_char[int(gray / unit)]</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># 返回给定路径图片的字符表示，用户在此还可以指定输出字符画的宽度和高度</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">output</span><span class="params">(imgpath, width=<span class="number">150</span>, height=<span class="number">100</span>)</span>:</span></div><div class="line">	im = Image.open(imgpath)</div><div class="line">	im = im.resize((width, height), Image.NEAREST)</div><div class="line">	<span class="comment"># 裁剪</span></div><div class="line">	box = (<span class="number">0</span>, <span class="number">30</span>, width, <span class="number">70</span>)</div><div class="line">	<span class="comment"># 这里的参数可以这么认为：从某图的(x,y)坐标开始截，截到(width+x,height+y)坐标</span></div><div class="line">	<span class="comment"># 所包围的图像，crop方法与php中的imagecopy方法大为不一样</span></div><div class="line">	newIm = im.crop(box)</div><div class="line">	txt = <span class="string">""</span></div><div class="line">	<span class="keyword">for</span> h <span class="keyword">in</span> range(newIm.size[<span class="number">1</span>]):</div><div class="line">		<span class="keyword">for</span> w <span class="keyword">in</span> range(newIm.size[<span class="number">0</span>]):</div><div class="line">			txt += select_ascii_char(*newIm.getpixel((w, h))[:<span class="number">3</span>])  <span class="comment"># 此处请看详解（1）</span></div><div class="line">		txt += <span class="string">'\n'</span></div><div class="line">	<span class="keyword">return</span> txt</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_as_txtfile</span><span class="params">(txt)</span>:</span></div><div class="line">	<span class="keyword">with</span> open(<span class="string">'imgtochar.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">		f.write(txt)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">codeBegin</span><span class="params">()</span>:</span></div><div class="line">	print(output(imgpath))</div><div class="line">	save_as_txtfile(output(imgpath))</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCheckCode</span><span class="params">(image_get_url)</span>:</span></div><div class="line">	im = requests.get(image_get_url)  <span class="comment"># 获取验证码和cookies值</span></div><div class="line">	<span class="keyword">with</span> open(<span class="string">'check_code.jpg'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">		f.write(im.content)</div><div class="line">	<span class="comment"># img = Image.open('check_code.jpg')</span></div><div class="line">	<span class="comment"># img.show()</span></div><div class="line">	codeBegin()</div><div class="line">	check_code = input(<span class="string">"code:"</span>)</div><div class="line">	print(<span class="string">"your input:"</span> + check_code)</div><div class="line">	<span class="keyword">return</span> check_code</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></div><div class="line">	files = os.listdir(<span class="string">'.'</span>)</div><div class="line">	<span class="keyword">if</span> <span class="string">'cookies.txt'</span> <span class="keyword">in</span> files:</div><div class="line">		<span class="keyword">with</span> open(<span class="string">'cookies.txt'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</div><div class="line">			cookies = requests.utils.cookiejar_from_dict(pickle.load(f))</div><div class="line">			bt_session = requests.session()</div><div class="line">			bt_session.cookies = cookies</div><div class="line">		<span class="keyword">try</span>:</div><div class="line">			torrent_url = <span class="string">'http://bt.byr.cn/torrents.php'</span></div><div class="line">			test = bt_session.get(torrent_url)</div><div class="line">			<span class="keyword">if</span> test.status_code != <span class="number">200</span> <span class="keyword">or</span> test.url != torrent_url:</div><div class="line">				print(<span class="string">'Something wrong when login in. Delete the cookies and relogin plese.\n'</span>)</div><div class="line">				<span class="keyword">return</span></div><div class="line">		<span class="keyword">except</span>:</div><div class="line">			print(<span class="string">"net error"</span>)</div><div class="line">			<span class="keyword">return</span></div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		username = input(<span class="string">"your username:"</span>)</div><div class="line">		password = input(<span class="string">"your password:"</span>)</div><div class="line">		login_php = <span class="string">'http://bt.byr.cn/login.php'</span></div><div class="line">		<span class="keyword">try</span>:</div><div class="line">			bt_session = requests.Session()</div><div class="line">			req = bt_session.get(login_php)</div><div class="line">		<span class="keyword">except</span>:</div><div class="line">			print(<span class="string">"net error"</span>)</div><div class="line">			<span class="keyword">return</span></div><div class="line">		print(req.text)</div><div class="line">		<span class="comment"># &lt;input name="imagehash" value="2cb98173c9a2fc28f0976f9a5b715db5"&gt;</span></div><div class="line">		imageHash = re.findall(<span class="string">'name=\"imagehash\" value=\"(.*)\"/&gt;'</span>, req.text)[<span class="number">0</span>]</div><div class="line">		print(imageHash)</div><div class="line">		image_get_url = <span class="string">'http://bt.byr.cn/image.php?action=regimage&amp;imagehash='</span> + imageHash</div><div class="line">		check_code = getCheckCode(image_get_url)</div><div class="line">		login_post_url = <span class="string">'http://bt.byr.cn/takelogin.php'</span></div><div class="line">		login_datas = &#123;</div><div class="line">			<span class="string">'username'</span>: username,</div><div class="line">			<span class="string">'password'</span>: password,</div><div class="line">			<span class="string">'imagestring'</span>: check_code,</div><div class="line">			<span class="string">'imagehash'</span>: imageHash</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">try</span>:</div><div class="line">			main_page = bt_session.post(login_post_url, login_datas)</div><div class="line">			print(main_page.text)</div><div class="line">			<span class="keyword">if</span> main_page.url != <span class="string">"http://bt.byr.cn/index.php"</span>:</div><div class="line">				print(<span class="string">"login error"</span>)</div><div class="line">				<span class="keyword">return</span></div><div class="line">			<span class="keyword">with</span> open(<span class="string">'cookies.txt'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">				pickle.dump(requests.utils.dict_from_cookiejar(bt_session.cookies), f)</div><div class="line">		<span class="keyword">except</span>:</div><div class="line">			print(<span class="string">"net error"</span>)</div><div class="line">	<span class="keyword">return</span> bt_session</div><div class="line"></div><div class="line"></div><div class="line">session = login()</div></pre></td></tr></table></figure><p>郑重声明：本系列文章提供的是在无ipv6环境下访问北邮人BT并且下载资源的一种方式，重在技术探讨，严禁使用本教程方法传播销售BT资源，否则造成的后果自负。在未获得作者本人许可之前不得将本文转载，转载请联系fuxuemingzhu#163.com（将#换成@)。</p><h2 id="走心推广"><a href="#走心推广" class="headerlink" title="走心推广"></a>走心推广</h2><p>因为本博客部署在Digital Ocean 服务器上，每个月都要有5美元的成本，对于学生党来说也是不小开支。所以既然你能看到这篇博客的话，希望你能帮助我一下，鼓励我写出更好的文章。</p><h3 id="Digital-Ocean-服务器购买"><a href="#Digital-Ocean-服务器购买" class="headerlink" title="Digital Ocean 服务器购买"></a>Digital Ocean 服务器购买</h3><p>如果你也需要购买服务器，强烈推荐Digital Ocean，推荐原因如下：</p><ul><li>基础套餐很便宜，每月最低5美元</li><li>服务器资源很给力，基础套餐配置是512MB内存，20GB的SSD硬盘，<strong>带宽不限制</strong></li><li>可以搭建ShadowSocks，实现科学上网（特别实用！！）</li><li>支持ipv6，轻松解决校园网流量不够用的问题</li></ul><p>我使用的是san francisco节点，搭建好ss之后，看油管1080p视频轻松无压力！！</p><p>你如果使用我的这个网址注册Digital Ocean，<strong>你可以得到10美元的代金券</strong>，我也能赚到一点，就是这个链接：<a href="https://m.do.co/c/86d4e56f6c7a" target="_blank" rel="external">https://m.do.co/c/86d4e56f6c7a</a>。</p><p>另外，如果你也是学生，有校园网邮箱，即可申请GitHub的Student Pack，免费送你50美刀的Digital Ocean代金券！地址是：<a href="https://education.github.com/pack/offers" target="_blank" rel="external">https://education.github.com/pack/offers</a>。</p><h3 id="菜菜手绘坊"><a href="#菜菜手绘坊" class="headerlink" title="菜菜手绘坊"></a>菜菜手绘坊</h3><p>菜菜手绘坊是我的姐姐在经营的一个手绘店铺，每一笔都是我的姐姐亲自画出来的。手绘坊里有很多风格可以选择，特别适合做头像，屏保，聊天背景等等！！甚至可以画好图之后做成手机壳，情侣T恤都是可以的！价格真的很便宜，可以加微信具体聊价格，绝对会让你惊喜！</p><p>更详细的宣传可以看我的这篇文章：<a href="http://fuxuemingzhu.me/drawing/">http://fuxuemingzhu.me/drawing/</a></p><p><strong>店主微信和QQ：290885604</strong></p><p>下面是暗黑风格的，看看有没有心动：</p><p>暗黑风格：<br><img src="http://fuxuemingzhu.me/drawing/index/caicai-drawing-dark2.jpg" alt="暗黑"></p></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>如果满分10分，你会给这篇文章打几分？</div><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>赞赏</span></button><div id="QR" style="display:block"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechatpay.jpg" alt="负雪明烛 微信"><p>微信</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/images/alipay.jpg" alt="负雪明烛 支付宝"><p>支付宝</p></div></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> 负雪明烛</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="http://fuxuemingzhu.me/2017/08/25/byrbt-login/" title="Python实现北邮人BT模拟登录">http://fuxuemingzhu.me/2017/08/25/byrbt-login/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/python/" rel="tag"># python</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/08/12/hexo-next-polish/" rel="next" title="让你的Hexo博客变得更酷炫"><i class="fa fa-chevron-left"></i> 让你的Hexo博客变得更酷炫</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2018/06/12/MovieLens-Recommender/" rel="prev" title="动手实现基于协同过滤的电影推荐系统">动手实现基于协同过滤的电影推荐系统 <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="负雪明烛"><p class="site-author-name" itemprop="name">负雪明烛</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">18</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/fuxuemingzhu" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="http://blog.csdn.net/fuxuemingzhu" target="_blank" title="CSDN"><i class="fa fa-fw fa-link"></i>CSDN</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://merrier.wang/" title="Merrier说" target="_blank">Merrier说</a></li></ul></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#教程所需环境"><span class="nav-number">1.</span> <span class="nav-text">教程所需环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#前期配置"><span class="nav-number">2.</span> <span class="nav-text">前期配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#登录分析"><span class="nav-number">3.</span> <span class="nav-text">登录分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证码处理"><span class="nav-number">4.</span> <span class="nav-text">验证码处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#保存cookies"><span class="nav-number">5.</span> <span class="nav-text">保存cookies</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#完整代码"><span class="nav-number">6.</span> <span class="nav-text">完整代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#走心推广"><span class="nav-number">7.</span> <span class="nav-text">走心推广</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Digital-Ocean-服务器购买"><span class="nav-number">7.1.</span> <span class="nav-text">Digital Ocean 服务器购买</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#菜菜手绘坊"><span class="nav-number">7.2.</span> <span class="nav-text">菜菜手绘坊</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">负雪明烛</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><span class="post-meta-divider">|</span><div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div><div class="footer-custom">Hosted by <a href="https://pages.coding.me">Coding Pages</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv">您是第 <span class="busuanzi-value" id="busuanzi_value_site_uv"></span> 个小伙伴 </span><span class="site-pv">本站总浏览 <span class="busuanzi-value" id="busuanzi_value_site_pv"></span> 次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script id="dsq-count-scr" src="https://fuxuemingzhu.disqus.com/count.js" async></script><script type="text/javascript">var disqus_config=function(){this.page.url="http://fuxuemingzhu.me/2017/08/25/byrbt-login/",this.page.identifier="2017/08/25/byrbt-login/",this.page.title="Python实现北邮人BT模拟登录"},d=document,s=d.createElement("script");s.src="https://fuxuemingzhu.disqus.com/embed.js",s.setAttribute("data-timestamp",""+ +new Date),(d.head||d.body).appendChild(s)</script><script type="text/javascript" src="/js/src/love.js"></script><script type="text/javascript">var OriginTitile=document.title,st;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="负雪明烛在这里等你",clearTimeout(st)):(document.title="Got ya~～(￣▽￣～)~",st=setTimeout(function(){document.title=OriginTitile},3e3))})</script></body></html><!-- rebuild by neat -->